<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PXLNOVA Proxy Browser</title>
    <link rel="stylesheet" href="/assets/styles.css">
    <link rel="icon" href="/assets/w.png" type="image/x-icon">
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif; }
        header { display: flex; align-items: center; padding: 10px; background-color: #6a1b9a; color: white; }
        #url-bar { flex: 1; padding: 10px; margin: 0 10px; }
        #nav-buttons { display: flex; gap: 10px; }
        #tabs { display: flex; border-bottom: 1px solid #ccc; }
        .tab { padding: 10px 20px; cursor: pointer; }
        .tab.active { background-color: #9c4dcc; color: white; }
        #bookmark-bar { display: flex; gap: 10px; padding: 10px; background-color: #f1f1f1; }
        .bookmark { padding: 5px 10px; background-color: #ddd; cursor: pointer; }
        iframe { display: none; width: 100%; height: calc(100vh - 112px); border: none; }
    </style>
</head>
<body>

<header>
    <h1>PXLNOVA Proxy</h1>
    <input type="text" id="url-bar" placeholder="Enter URL or Search..." onkeydown="handleUrlInput(event)">
    <div id="nav-buttons">
        <button onclick="navigate(-1)">Back</button>
        <button onclick="navigate(1)">Forward</button>
        <button onclick="reloadPage()">Reload</button>
        <button onclick="addTab()">+</button>
        <button onclick="removeTab()">-</button>
    </div>
</header>

<div id="tabs"></div>
<div id="iframe-container"></div>
<div id="bookmark-bar"></div>

<script>
    let activeTabId = 1;
    let tabHistory = { 1: [] };
    let currentTabIndex = { 1: -1 };

    function handleUrlInput(event) {
        if (event.key === "Enter") {
            const url = document.getElementById('url-bar').value;
            loadWebsite(url);
        }
    }

    function loadWebsite(url) {
        const iframe = document.getElementById(`iframe-${activeTabId}`);
        if (iframe) {
            if (!tabHistory[activeTabId]) {
                tabHistory[activeTabId] = [];
                currentTabIndex[activeTabId] = -1;
            }
            tabHistory[activeTabId].push(url);
            currentTabIndex[activeTabId]++;
            iframe.src = `/proxy?url=${encodeURIComponent(url)}`;
            iframe.style.display = 'block';
            updateBookmarks(url);
        }
    }

    function navigate(direction) {
        const history = tabHistory[activeTabId];
        if (history) {
            const index = currentTabIndex[activeTabId] + direction;
            if (index >= 0 && index < history.length) {
                currentTabIndex[activeTabId] = index;
                loadWebsite(history[index]);
            }
        }
    }

    function reloadPage() {
        const iframe = document.getElementById(`iframe-${activeTabId}`);
        if (iframe) {
            iframe.contentWindow.location.reload();
        }
    }

    function addTab() {
        activeTabId++;
        const tab = document.createElement('div');
        tab.classList.add('tab', 'active');
        tab.innerText = `Tab ${activeTabId}`;
        tab.onclick = () => setActiveTab(activeTabId);
        document.getElementById('tabs').appendChild(tab);

        const iframe = document.createElement('iframe');
        iframe.id = `iframe-${activeTabId}`;
        document.getElementById('iframe-container').appendChild(iframe);

        tabHistory[activeTabId] = [];
        currentTabIndex[activeTabId] = -1;
        setActiveTab(activeTabId);
    }

    function removeTab() {
        if (activeTabId > 1) {
            document.getElementById(`iframe-${activeTabId}`).remove();
            document.querySelector(`.tab:nth-child(${activeTabId})`).remove();
            delete tabHistory[activeTabId];
            activeTabId--;
            setActiveTab(activeTabId);
        }
    }

    function setActiveTab(tabId) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('iframe').forEach(iframe => iframe.style.display = 'none');

        document.getElementById(`iframe-${tabId}`).style.display = 'block';
        document.querySelectorAll('.tab')[tabId - 1].classList.add('active');
        activeTabId = tabId;
    }

    function updateBookmarks(url) {
        const bookmarkBar = document.getElementById('bookmark-bar');
        const existingBookmark = Array.from(bookmarkBar.children).find(bookmark => bookmark.innerText === url);
        if (!existingBookmark) {
            const bookmark = document.createElement('div');
            bookmark.classList.add('bookmark');
            bookmark.innerText = url;
            bookmark.onclick = () => loadWebsite(url);
            bookmarkBar.appendChild(bookmark);
        }
    }

    // Initialize with one tab
    addTab();
</script>

</body>
</html>
